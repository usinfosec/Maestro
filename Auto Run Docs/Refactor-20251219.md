# Maestro Codebase Refactoring Audit - Phase I

> **Purpose:** Systematically examine the Maestro codebase for dead, deprecated, duplicated, and otherwise problematic code that requires refactoring.
>
> **Instructions:** For each numbered task below, examine the specified file(s) or directory. Document your findings in `Auto Run Docs/Refactor/{TASK_NUMBER}.md` covering ALL of these categories:
>
> 1. **Dead Code:** Unused exports, unreachable code paths, commented-out code blocks, unused imports, unused variables/functions
> 2. **Deprecated Patterns:** Outdated APIs, legacy approaches, old React patterns (class components, legacy lifecycle), callback-style async, manual DOM manipulation
> 3. **Duplication:** Similar logic repeated across files, copy-pasted code blocks, functions that could be consolidated, repeated type definitions
> 4. **Code Smells:** Overly complex functions (>50 lines), deep nesting (>3 levels), poor separation of concerns, missing error handling, magic numbers/strings, god objects/functions
> 5. **Type Safety Issues:** `any` types, missing type annotations, unsafe casts (`as`), non-null assertions (`!`), implicit any, weak typing
>
> **IMPORTANT:** Each task MUST examine ALL five categories above. Do not skip any category - if nothing is found, explicitly state "None found" for that category.
>
> **Output Format:** Each task document should follow this template:
> ```markdown
> # Refactor Task {NUMBER}: {FILE/DIRECTORY NAME}
>
> ## Summary
> Brief overview of findings across all categories.
>
> ## Dead Code
> - List of dead/unused code with file:line references
> - Or "None found" if clean
>
> ## Deprecated Patterns
> - List of outdated patterns that need modernization
> - Or "None found" if clean
>
> ## Duplication
> - List of duplicated logic and where it appears elsewhere
> - Or "None found" if clean
>
> ## Code Smells
> - List of problematic patterns (complexity, nesting, error handling, etc.)
> - Or "None found" if clean
>
> ## Type Safety Issues
> - List of type-related problems with file:line references
> - Or "None found" if clean
>
> ## Recommended Refactoring
> 1. Specific action item with priority (High/Medium/Low)
> 2. ...
>
> ## Estimated Impact
> Brief note on risk level and testing considerations.
> ```

---

## Main Process (`src/main/`)

- [x] **Task 1:** `src/main/index.ts`
  Main entry point and IPC handler registration. Examine for:
  - Dead: Unused IPC handlers, unreferenced imports
  - Deprecated: Old IPC patterns, legacy Electron APIs
  - Duplication: Handler logic that repeats across handlers
  - Smells: Overly long file, handlers that should be extracted
  - Types: Any types in handler parameters/returns

  **Completed:** See `Auto Run Docs/Refactor/1.md` for full audit. Key findings:
  - File is 2,142 lines (God file) - needs splitting into 5+ modules
  - 17 instances of `any` types identified
  - 4 instances of duplicated session lookup pattern
  - 15+ magic numbers/strings needing constants
  - Deprecated Claude API still supported alongside agentSessions
  - Recommended 7 high/medium priority refactoring actions

- [x] **Task 2:** `src/main/process-manager.ts`
  Process spawning for AI agents and terminals. Examine for:
  - Dead: Unused spawn configurations, dead process tracking code
  - Deprecated: Old child_process patterns, legacy PTY APIs
  - Duplication: Repeated spawn logic between AI and terminal processes
  - Smells: Complex process lifecycle, missing error recovery
  - Types: Process handle typing, event callback types

  **Completed:** See `Auto Run Docs/Refactor/2.md` for full audit. Key findings:
  - File is 1,127 lines with spawn() method at 623 lines (God method) - needs extraction into 5+ helper methods
  - 10 instances of `any` types identified, including ptyEnv cast and error handling
  - Environment setup duplicated 3 times between PTY, child process, and runCommand
  - Legacy Claude Code JSON format fallback should be deprecated once all agents use unified parser
  - Synchronous file operations (writeFileSync, unlinkSync) could block event loop
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 3:** `src/main/preload.ts`
  IPC bridge between main and renderer. Examine for:
  - Dead: Exposed APIs no longer called from renderer
  - Deprecated: Old contextBridge patterns
  - Duplication: Similar API wrapper patterns
  - Smells: Inconsistent API structure, missing validation
  - Types: Type safety of IPC bridge, any in exposed APIs

  **Completed:** See `Auto Run Docs/Refactor/3.md` for full audit. Key findings:
  - File is 1,926 lines - a God File that should be split into namespace modules
  - ~880 lines of duplicate type definitions (inline + MaestroAPI interface)
  - Deprecated Claude API (98 lines) still present, needs removal timeline
  - 17+ instances of `any` types, primarily in event handlers using `_: any`
  - Event listener pattern repeated 25+ times - needs helper abstraction
  - Local interface definitions duplicate shared/types.ts
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 4:** `src/main/agent-detector.ts`
  Agent detection and configuration. Examine for:
  - Dead: Detection code for agents never implemented
  - Deprecated: Old detection methods, hardcoded paths
  - Duplication: Similar detection logic across agents
  - Smells: Complex conditionals, missing agent validation
  - Types: Agent config typing, detection result types

  **Completed:** See `Auto Run Docs/Refactor/4.md` for full audit. Key findings:
  - 3 placeholder agent definitions (gemini-cli, qwen3-coder, aider) with minimal functionality
  - PATH expansion logic duplicated in 3 locations (agent-detector.ts, agent-spawner.ts, cliDetection.ts)
  - 2 `any` types in AgentConfigOption interface need proper typing
  - Model discovery logic could be extracted to separate service
  - Claude Code resumeArgs function defined but not used (hardcoded elsewhere)
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 5:** `src/main/agent-capabilities.ts`
  Agent capability definitions. Examine for:
  - Dead: Capability flags never checked
  - Deprecated: Legacy capability patterns
  - Duplication: Repeated capability definitions
  - Smells: Incomplete capability coverage
  - Types: Capability interface completeness

  **Completed:** See `Auto Run Docs/Refactor/5.md` for full audit. Key findings:
  - AgentCapabilities interface duplicated in 3 files (agent-capabilities.ts, preload.ts, useAgentCapabilities.ts)
  - preload.ts missing 3 capability properties: `supportsModelSelection`, `requiresPromptToStart`, `supportsStreamJsonInput`
  - 4 placeholder agent configurations (gemini-cli, qwen3-coder, aider) that are dead code until integration
  - 4 capabilities defined but never checked in UI code: `supportsBatchMode`, `supportsResultMessages`, `supportsStreaming`, `supportsJsonOutput`
  - Record<string, AgentCapabilities> allows typos without compile error - should use AgentId union
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 6:** `src/main/agent-session-storage.ts`
  Session storage interface. Examine for:
  - Dead: Storage methods never called
  - Deprecated: Old storage patterns
  - Duplication: Logic duplicated in implementations
  - Smells: Interface too broad or too narrow
  - Types: Storage interface type safety

  **Completed:** See `Auto Run Docs/Refactor/6.md` for full audit. Key findings:
  - File is well-structured (270 lines) with clean interface design
  - `SessionMessage` type duplicated in 4 locations (agent-session-storage.ts, global.d.ts, claude.ts, test file)
  - `toolUse?: unknown` weak typing should be replaced with proper `ToolUseBlock` interface
  - `clearStorageRegistry()` only used in tests (intentional, for test isolation)
  - Magic string 'terminal' should be extracted to constant
  - Recommended 5 low-to-medium priority refactoring actions

- [x] **Task 7:** `src/main/web-server.ts`
  Fastify server for web/mobile interface. Examine for:
  - Dead: Unused routes, dead middleware
  - Deprecated: Old Fastify patterns, legacy route handling
  - Duplication: Route logic that should be consolidated
  - Smells: Route handler complexity, missing error handling
  - Types: Request/response typing, handler types

  **Completed:** See `Auto Run Docs/Refactor/7.md` for full audit. Key findings:
  - Well-refactored with routes/handlers/services extracted to src/main/web-server/
  - 6 type definitions duplicated across 3-4 locations (AITabData, LiveSessionInfo, CustomAICommand, etc.)
  - 14 callback setter methods with repetitive patterns - could use single setCallbacks() method
  - Session enrichment logic duplicated in 4 locations
  - Synchronous readFileSync in static routes could block event loop
  - 4 instances of weak index signature types with `[key: string]: unknown`
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 8:** `src/main/tunnel-manager.ts`
  Cloudflare tunnel support. Examine for:
  - Dead: Unused tunnel configurations
  - Deprecated: Old tunnel API usage
  - Duplication: Repeated connection logic
  - Smells: Missing retry logic, error handling gaps
  - Types: Tunnel state typing

  **Completed:** See `Auto Run Docs/Refactor/8.md` for full audit. Key findings:
  - File is well-structured (142 lines) with minimal issues
  - 2 type definitions duplicated across main/renderer (TunnelStatus, TunnelResult)
  - 2 magic numbers (30000ms timeout, 3000ms grace period) should be constants
  - Missing retry logic for transient network failures
  - Renderer's `TunnelStatus` type conflicts with main process type (different format)
  - Recommended 5 low-to-medium priority refactoring actions

- [x] **Task 9:** `src/main/history-manager.ts`
  Per-session history storage. Examine for:
  - Dead: Unused history methods
  - Deprecated: Inefficient storage patterns
  - Duplication: Logic shared with IPC handlers
  - Smells: Performance issues, unbounded growth
  - Types: History entry typing

  **Completed:** See `Auto Run Docs/Refactor/9.md` for full audit. Key findings:
  - File is well-structured (523 lines) with clean class-based design
  - Major duplication with `src/cli/services/storage.ts` (6 methods reimplemented)
  - 3 public methods (`hasMigrated`, `getLegacyFilePath`, `getHistoryDir`) marked for testing but no tests exist
  - 2 methods marked `@deprecated` but still used in IPC handlers
  - 18 synchronous file operations (`fs.*Sync`) could block event loop - should use async
  - 4 catch blocks have implicit `any` error type
  - `updateSessionNameByClaudeSessionId` scans ALL history files - potential performance issue
  - No unit tests exist for this critical persistence component
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 10:** `src/main/auto-updater.ts` and `src/main/update-checker.ts`
  Update functionality. Examine for:
  - Dead: Unused update paths
  - Deprecated: Old auto-update patterns
  - Duplication: Logic split between two files
  - Smells: Update state management complexity
  - Types: Update event typing

  **Completed:** See `Auto Run Docs/Refactor/10.md` for full audit. Key findings:
  - `checkForUpdatesManual()` function is exported but never called (dead code)
  - `UpdateCheckResult`, `UpdateStatus`, and `Release` types duplicated across 3-4 locations each
  - Update status type appears 4 times within preload.ts alone
  - `_: any` and `status: any` in preload.ts onStatus handler need proper typing
  - Dual-check architecture (GitHub API + electron-updater) is intentional but undocumented
  - Recommended 5 refactoring actions prioritized by impact

- [x] **Task 11:** `src/main/themes.ts`
  Theme handling in main process. Examine for:
  - Dead: Unused theme utilities
  - Deprecated: Legacy theme handling
  - Duplication: Theme logic in main vs renderer vs shared
  - Smells: Theme validation issues
  - Types: Theme type definitions

  **Completed:** See `Auto Run Docs/Refactor/11.md` for full audit. Key findings:
  - File is exemplary 10-line re-export layer delegating to shared/themes.ts
  - `getThemeById` exported from renderer but never used in renderer code
  - `isValidThemeId` type guard only used in tests, never in production
  - `ThemeColors` name collision in useThemeStyles.ts (minimal interface vs full)
  - Theme ID list duplicated between ThemeId type and validIds array
  - Recommended 5 low-priority refactoring actions

- [x] **Task 12:** `src/main/constants.ts`
  Main process constants. Examine for:
  - Dead: Constants never referenced
  - Deprecated: Outdated constant values
  - Duplication: Constants duplicated in renderer/shared
  - Smells: Magic values that should be constants
  - Types: Const assertions, literal types

  **Completed:** See `Auto Run Docs/Refactor/12.md` for full audit. Key findings:
  - 2 type exports (`ClaudeSessionParseLimits`, `ClaudePricing`) defined but never imported
  - `STATS_BATCH_SIZE` constant defined but never used (dead code)
  - Cost calculation logic duplicated in 4 files (~20 repetitions of the formula)
  - Codex has its own parse limits constant that could be consolidated
  - Magic number `1_000_000` repeated across all cost calculations
  - Recommended 7 refactoring actions prioritized by impact

---

## Main Process - IPC Handlers (`src/main/ipc/handlers/`)

- [x] **Task 13:** `src/main/ipc/handlers/agentSessions.ts`
  Agent session IPC handlers. Examine for:
  - Dead: Handlers never invoked from renderer
  - Deprecated: Old IPC handler patterns
  - Duplication: Overlap with agents.ts handlers
  - Smells: Handler complexity, missing validation
  - Types: Parameter/return type safety

  **Completed:** See `Auto Run Docs/Refactor/13.md` for full audit. Key findings:
  - File is 795 lines with well-structured handlers and proper error logging
  - No dead code - all handlers are exposed via preload.ts and actively used
  - Session discovery logic duplicated with storage classes (discoverClaudeSessionFiles, discoverCodexSessionFiles)
  - Cost calculation `calculateClaudeCost()` duplicated 6+ times across codebase
  - `GlobalAgentStats` interface duplicated in AboutModal.tsx
  - 9 empty catch blocks silently swallow errors during session discovery
  - `getGlobalStats` handler is 200+ lines and should be extracted to dedicated class
  - Excellent type safety - no `any` types
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 14:** `src/main/ipc/handlers/agents.ts`
  Agent management IPC handlers. Examine for:
  - Dead: Unused agent management handlers
  - Deprecated: Legacy agent API patterns
  - Duplication: Logic shared with agentSessions.ts
  - Smells: Agent state management issues
  - Types: Agent type definitions

  **Completed:** See `Auto Run Docs/Refactor/14.md` for full audit. Key findings:
  - File is well-structured (382 lines) with all 16 handlers actively used
  - `AgentConfigsData` interface duplicated in 6 locations across codebase
  - Config access pattern `agentConfigsStore.get('configs', {})` repeated 13 times
  - 3 `any` types in `stripAgentFunctions` that need proper typing
  - `AgentConfig` interface duplicated in 8+ locations (see also Task 4)
  - No dead code or deprecated patterns found
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 15:** `src/main/ipc/handlers/autorun.ts`
  Auto Run IPC handlers. Examine for:
  - Dead: Unused Auto Run handlers
  - Deprecated: Old file handling patterns
  - Duplication: File operations repeated elsewhere
  - Smells: Missing error handling, path validation
  - Types: File/document type safety

  **Completed:** See `Auto Run Docs/Refactor/15.md` for full audit. Key findings:
  - File is well-structured (499 lines) with good test coverage and proper path validation security
  - Debug `console.log` and `[DEBUG]` logging left in production code (lines 171-175)
  - `TreeNode` interface duplicates `src/shared/treeUtils.ts`, should import from shared
  - Image extension arrays duplicated twice within file and 2+ other locations across codebase
  - Path validation logic duplicated inline in `saveImage`/`deleteImage` despite helper existing
  - Unused `mainWindow` parameter in function signature (only `getMainWindow` used)
  - Single global debounce timer could cause interference between watched folders
  - Excellent type safety - no `any` types found
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 16:** `src/main/ipc/handlers/claude.ts`
  Claude-specific handlers. Examine for:
  - Dead: Claude handlers that should use generic agent API
  - Deprecated: Claude-specific patterns that should be generic
  - Duplication: Logic that belongs in generic agent handlers
  - Smells: Tight coupling to Claude implementation
  - Types: Claude-specific type leakage

  **Completed:** See `Auto Run Docs/Refactor/16.md` for full audit. Key findings:
  - Entire file (1,566 lines) is deprecated legacy code - should migrate to `agentSessions:*` API
  - Cost calculation formula duplicated 4 times within file (16 occurrences of `1_000_000` magic number)
  - Session content parsing logic duplicated 4+ times across codebase
  - `ClaudeSessionOrigin` types duplicated in 4 separate files
  - 30 empty/silent catch blocks that mask errors
  - `claude:getGlobalStats` handler is ~200 lines God method
  - 6 uses of `unknown` type that should have proper typing
  - Still actively used by 10+ renderer call sites (migration required)
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 17:** `src/main/ipc/handlers/git.ts`
  Git IPC handlers. Examine for:
  - Dead: Unused git operations
  - Deprecated: Old git command patterns
  - Duplication: Git logic in handlers vs services
  - Smells: Shell injection risks, error handling
  - Types: Git result typing

  **Completed:** See `Auto Run Docs/Refactor/17.md` for full audit. Key findings:
  - File is well-structured (579 lines) with good delegation to shared/gitUtils.ts
  - No dead code - all 17 handlers are exposed via preload.ts and actively used
  - Runtime `require('child_process')` should be ES import at file top
  - `WorktreeConfig` interface duplicated in shared/types.ts and renderer/types/index.ts
  - **Bug: preload.ts type mismatches** - `git:status` and `git:diff` declare `Promise<string>` but handlers return `{ stdout, stderr }`
  - Log entry result missing `additions`/`deletions` fields in preload.ts type
  - `git:worktreeSetup` handler is 107 lines - should be extracted to service class
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 18:** `src/main/ipc/handlers/groupChat.ts`
  Group chat handlers. Examine for:
  - Dead: Unused group chat operations
  - Deprecated: Legacy chat patterns
  - Duplication: Logic with main group-chat module
  - Smells: Message handling complexity
  - Types: Chat message type safety

  **Completed:** See `Auto Run Docs/Refactor/18.md` for full audit. Key findings:
  - File is well-structured (484 lines) with proper error handling patterns
  - 2 unused re-exports (`sendToModerator`, `IProcessManager`) marked "for potential future use"
  - 2 handlers accept `images?: string[]` parameter but never use it
  - `GroupChatState` type duplicated (also in shared/group-chat-types.ts)
  - `ModeratorUsage` interface duplicated in preload.ts (2 locations)
  - Emitter window check pattern repeated 5 times - could use helper
  - `GenericProcessManager` interface missing `customEnvVars` used by router
  - Recommended 7 low-to-medium priority refactoring actions

- [x] **Task 19:** `src/main/ipc/handlers/history.ts`
  History handlers. Examine for:
  - Dead: Unused history operations
  - Deprecated: Legacy history patterns
  - Duplication: Logic with history-manager.ts
  - Smells: Query performance, pagination issues
  - Types: History query/result typing

  **Completed:** See `Auto Run Docs/Refactor/19.md` for full audit. Key findings:
  - File is well-structured (229 lines) with clean delegation to HistoryManager
  - `history:reload` is a no-op kept for API compatibility - should be deprecated
  - Major duplication with `src/cli/services/storage.ts` (6+ methods reimplemented)
  - HistoryEntry type defined inline ~3 times in preload.ts instead of importing from shared/types.ts
  - External change event ignores sessionId parameter, forcing inefficient full reloads
  - Type mismatch: `history:clear` handler accepts sessionId but preload.ts type doesn't expose it
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 20:** `src/main/ipc/handlers/persistence.ts`
  Persistence handlers. Examine for:
  - Dead: Unused persistence operations
  - Deprecated: Old storage patterns
  - Duplication: Persistence logic spread across handlers
  - Smells: Data validation, corruption handling
  - Types: Persistence data type safety

  **Completed:** See `Auto Run Docs/Refactor/20.md` for full audit. Key findings:
  - File is well-structured (200 lines) with clean dependency injection pattern
  - No dead code or deprecated patterns found
  - `MaestroSettings` interface duplicated in 4 files (index.ts, persistence.ts, system.ts, process.ts)
  - `SessionsData` and `GroupsData` duplicated in 2 files each
  - 8 instances of `any` types - sessions/groups should use shared/types.ts imports
  - JSON.stringify used for object comparison (fragile, inefficient)
  - Silent error suppression in `cli:getActivity` handler
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 21:** `src/main/ipc/handlers/playbooks.ts`
  Playbook handlers. Examine for:
  - Dead: Unused playbook operations
  - Deprecated: Legacy playbook format handling
  - Duplication: Playbook logic with CLI
  - Smells: Playbook validation, execution safety
  - Types: Playbook schema typing

  **Completed:** See `Auto Run Docs/Refactor/21.md` for full audit. Key findings:
  - `mainWindow` parameter in `PlaybooksHandlerDependencies` is never used (dead code)
  - Playbook read/write logic duplicated between main process and CLI (`src/cli/services/playbooks.ts`)
  - `Playbook` and `PlaybookDocumentEntry` types duplicated in 3+ locations instead of importing from shared
  - 7 instances of `any` types in function signatures and callbacks
  - preload.ts types missing `export`/`import` methods, `maxLoops` field, and `prTargetBranch` in worktreeSettings
  - Silent error swallowing in `readPlaybooks()` catch block (doesn't check error code)
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 22:** `src/main/ipc/handlers/process.ts`
  Process management handlers. Examine for:
  - Dead: Unused process operations
  - Deprecated: Old process management patterns
  - Duplication: Logic with process-manager.ts
  - Smells: Process lifecycle complexity
  - Types: Process state typing

  **Completed:** See `Auto Run Docs/Refactor/22.md` for full audit. Key findings:
  - File is well-structured (403 lines) with clean delegation via `withIpcErrorLogging`
  - ProcessConfig type duplicated in 5 locations with different fields (sync risk)
  - Shell configuration loading duplicated between `spawn` and `runCommand` handlers
  - Custom args parsing regex duplicated in 3+ locations across codebase
  - `MaestroSettings` and `AgentConfigsData` interfaces duplicated in 4-5 locations
  - `process:spawn` handler is 233 lines - should extract helper functions
  - 2 instances of `any` types that should be properly typed
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 23:** `src/main/ipc/handlers/system.ts`
  System handlers. Examine for:
  - Dead: Unused system operations
  - Deprecated: Old system API usage
  - Duplication: System utils elsewhere
  - Smells: Security concerns, privilege escalation
  - Types: System info typing

  **Completed:** See `Auto Run Docs/Refactor/23.md` for full audit. Key findings:
  - Well-structured 427-line file with no dead code - all handlers actively used
  - `MaestroSettings` interface duplicated in 4+ files with different subsets
  - `BootstrapSettings` interface duplicated in system.ts and group-chat-storage.ts
  - `LogLevel` type literal written inline 3 times instead of importing from logger.ts
  - Fallback font array duplicated twice within file
  - 8 synchronous file operations in sync handler (low priority - rare operation)
  - No unit tests exist for this file
  - Recommended 7 refactoring actions prioritized by impact

---

## Main Process - Parsers (`src/main/parsers/`)

- [x] **Task 24:** `src/main/parsers/agent-output-parser.ts`
  Base parser interface. Examine for:
  - Dead: Interface methods never implemented
  - Deprecated: Old parsing patterns
  - Duplication: Common parsing logic
  - Smells: Parser interface design
  - Types: Parse result type safety

  **Completed:** See `Auto Run Docs/Refactor/24.md` for full audit. Key findings:
  - `hasOutputParser` function only used in tests (dead code candidate)
  - `raw: unknown` field is required but never read in production - consider making optional
  - `toolState?: unknown` weak typing should use proper interface
  - Unsafe `as ToolType` casts in getOutputParser/hasOutputParser bypass type safety
  - MockParser in test file missing `detectErrorFromLine` and `detectErrorFromExit` methods
  - ParsedEvent example in AGENT_SUPPORT.md duplicates interface definition
  - Recommended 7 low-to-medium priority refactoring actions

- [x] **Task 25:** `src/main/parsers/claude-output-parser.ts`
  Claude output parser. Examine for:
  - Dead: Parsing branches never hit
  - Deprecated: Old Claude output format handling
  - Duplication: Parsing logic shared with other parsers
  - Smells: Complex regex, fragile parsing
  - Types: Claude output type definitions

  **Completed:** See `Auto Run Docs/Refactor/25.md` for full audit. Key findings:
  - Well-structured 336-line file with excellent test coverage (438-line test file)
  - No dead code - all methods actively used by process-manager.ts
  - process-manager.ts lines 608-635 contain legacy fallback duplicating parser logic
  - Text extraction pattern duplicated in 4 locations (claude-output-parser, claude.ts x2, claude-session-storage)
  - Usage extraction duplicated 3 times between parser and process-manager
  - Excellent type safety - no `any` types, only minor `toolState?: unknown` weakness
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 26:** `src/main/parsers/opencode-output-parser.ts`
  OpenCode parser. Examine for:
  - Dead: Stub code that's not implemented
  - Deprecated: Placeholder patterns
  - Duplication: Base parser logic
  - Smells: Incomplete implementation
  - Types: Type stubs vs real types

  **Completed:** See `Auto Run Docs/Refactor/26.md` for full audit. Key findings:
  - Parser is fully implemented and production-ready (not a stub)
  - Excellent documentation and test coverage (326-line test file)
  - No dead code or deprecated patterns found
  - `detectErrorFromLine` and `detectErrorFromExit` logic duplicated with ClaudeOutputParser (~60 lines each)
  - Error message extraction logic duplicated twice within file (lines 205-215, 319-329)
  - `toolState` uses `unknown` type (intentional per interface, but OpenCode has typed structure)
  - Recommended 5 low-to-medium priority refactoring actions

- [x] **Task 27:** `src/main/parsers/codex-output-parser.ts`
  Codex parser. Examine for:
  - Dead: Stub code that's not implemented
  - Deprecated: Placeholder patterns
  - Duplication: Base parser logic
  - Smells: Incomplete implementation
  - Types: Type stubs vs real types

  **Completed:** See `Auto Run Docs/Refactor/27.md` for full audit. Key findings:
  - Parser is fully implemented and production-ready (not a stub)
  - Excellent documentation and comprehensive test coverage (489-line test file)
  - No dead code or deprecated patterns found
  - `detectErrorFromLine` and `detectErrorFromExit` logic duplicated across all 3 parsers (~80 lines each)
  - Hardcoded `MODEL_CONTEXT_WINDOWS` list (~17 models) should be moved to constants
  - Simple TOML parsing via regex has documented limitations
  - `toolState?: unknown` weak typing could use proper CodexToolState interface
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 28:** `src/main/parsers/error-patterns.ts`
  Error detection patterns. Examine for:
  - Dead: Error patterns never matched
  - Deprecated: Old error format patterns
  - Duplication: Similar patterns that could merge
  - Smells: Regex complexity, false positives
  - Types: Error pattern typing

  **Completed:** See `Auto Run Docs/Refactor/28.md` for full audit. Key findings:
  - `registerErrorPatterns()` and `clearPatternRegistry()` only used in tests (intentional for test isolation)
  - Major duplication: `detectErrorFromLine` (~80 lines) and `detectErrorFromExit` (~45 lines) duplicated across all 3 parsers
  - ~70% of error patterns shared across CLAUDE/OPENCODE/CODEX definitions - could use base patterns
  - Regex patterns `/529/i` and `/429/i` too broad - will match any substring, not just error codes
  - Hardcoded `errorTypes` array duplicates `AgentErrorType` type - could become stale
  - Unsafe `as ToolType` cast in `getErrorPatterns()` bypasses type validation
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 29:** `src/main/parsers/usage-aggregator.ts`
  Usage stats aggregation. Examine for:
  - Dead: Unused aggregation methods
  - Deprecated: Old stats format handling
  - Duplication: Stats logic elsewhere
  - Smells: Aggregation accuracy, edge cases
  - Types: Stats type safety

  **Completed:** See `Auto Run Docs/Refactor/29.md` for full audit. Key findings:
  - Well-structured 94-line utility module with no dead code or deprecated patterns
  - **Critical duplication:** `UsageStats` interface defined 5 times across codebase with variations
  - Aggregation logic duplicated in `src/cli/services/agent-spawner.ts` (32 lines copy-pasted)
  - Context usage calculation formula duplicated 5+ times in UI components
  - Magic number `200000` (default context window) appears 60+ times without shared constant
  - `useWebSocket.ts` version has all optional fields vs required in other definitions
  - Recommended 5 refactoring actions prioritized by impact

---

## Main Process - Storage (`src/main/storage/`)

- [x] **Task 30:** `src/main/storage/claude-session-storage.ts`
  Claude session storage. Examine for:
  - Dead: Unused storage methods
  - Deprecated: Old Claude session format
  - Duplication: Logic that should be in base class
  - Smells: File handling, concurrency issues
  - Types: Session data type safety

  **Completed:** See `Auto Run Docs/Refactor/30.md` for full audit. Key findings:
  - File is well-structured (932 lines) with no dead code or deprecated patterns
  - `extractTextFromContent()` duplicated 3 times (claude-session-storage, claude.ts, codex-session-storage)
  - `calculateCost()` function duplicated 6+ times with 24 instances of magic `1_000_000` number
  - `ClaudeSessionOriginsData` interface duplicated in 4 files
  - `parseSessionFile()` logic (~100 lines) duplicated in deprecated claude.ts
  - 3 methods exceed 100 lines: `parseSessionFile`, `searchSessions`, `deleteMessagePair`
  - 7 silent catch blocks that swallow parsing errors
  - Uses `unknown` types for message content that could be properly typed
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 31:** `src/main/storage/opencode-session-storage.ts`
  OpenCode storage stub. Examine for:
  - Dead: Stub implementation details
  - Deprecated: Placeholder code
  - Duplication: Base class usage
  - Smells: Incomplete implementation markers
  - Types: Stub type safety

  **Completed:** See `Auto Run Docs/Refactor/31.md` for full audit. Key findings:
  - File is fully implemented (723 lines), NOT a stub - production-ready storage implementation
  - No dead code or deprecated patterns found
  - Search session logic (~95 lines) duplicated across all 3 storage implementations - could share 60-70%
  - Pagination logic (~20 lines) identical in all 3 storage classes - should extract to utility
  - `deleteMessagePair` method is 165 lines - could extract helper methods
  - 13 silent catch blocks (mostly intentional for "file not found" scenarios)
  - No unit tests exist - critical gap for a file-modifying storage implementation
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 32:** `src/main/storage/codex-session-storage.ts`
  Codex storage stub. Examine for:
  - Dead: Stub implementation details
  - Deprecated: Placeholder code
  - Duplication: Base class usage
  - Smells: Incomplete implementation markers
  - Types: Stub type safety

  **Completed:** See `Auto Run Docs/Refactor/32.md` for full audit. Key findings:
  - File is fully implemented (877 lines), NOT a stub - production-ready Codex CLI storage
  - No dead code or deprecated patterns found
  - Search session logic (~95 lines) duplicated across all 3 storage implementations - could share 60-70%
  - Pagination logic (~20 lines) identical in all 3 storage classes - should extract to utility
  - `extractTextFromContent()` function duplicated in 3 storage files
  - `deleteMessagePair` method is 165 lines - could extract 4-5 helper methods
  - 12 silent catch blocks (mostly intentional for "file not found" scenarios)
  - No unit tests exist - critical gap for a file-modifying storage implementation
  - Recommended 7 refactoring actions prioritized by impact

---

## Main Process - Utilities (`src/main/utils/`)

- [x] **Task 33:** `src/main/utils/execFile.ts`
  Safe command execution. Examine for:
  - Dead: Unused execution utilities
  - Deprecated: Old exec patterns
  - Duplication: Similar utils elsewhere
  - Smells: Security, injection prevention
  - Types: Exec result typing

  **Completed:** See `Auto Run Docs/Refactor/33.md` for full audit. Key findings:
  - Exemplary 46-line utility file with excellent 567-line test coverage
  - No dead code or deprecated patterns
  - **Type bug:** `ExecResult.exitCode` declared as `number` but can be string ('ENOENT', 'EPERM')
  - **Logic bug:** `error.code || 1` incorrectly handles exit code 0 (should use `??`)
  - Minor duplication: CLI's `batch-processor.ts` uses `execFileSync` directly instead of shared utility
  - Recommended 4 low-high priority refactoring actions

- [x] **Task 34:** `src/main/utils/logger.ts`
  Main process logger. Examine for:
  - Dead: Unused log levels/methods
  - Deprecated: Old logging patterns
  - Duplication: Logger in renderer/web
  - Smells: Log formatting, performance
  - Types: Log entry typing

  **Completed:** See `Auto Run Docs/Refactor/34.md` for full audit. Key findings:
  - Well-structured 192-line file with excellent 599-line test coverage
  - `LogLevel` type duplicated in 3 locations (main, renderer, web) with different values
  - `LogEntry` interface conflated with session `LogEntry` in 4+ locations
  - preload.ts missing `toast` and `autorun` methods in MaestroAPI type definition
  - preload.ts uses `string` instead of `LogLevel` type for level parameter
  - Magic number `1000` for default log buffer should be named constant
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 35:** `src/main/utils/shellDetector.ts`
  Shell detection. Examine for:
  - Dead: Detection for shells never used
  - Deprecated: Old shell detection methods
  - Duplication: Shell logic elsewhere
  - Smells: Platform-specific issues
  - Types: Shell config typing

  **Completed:** See `Auto Run Docs/Refactor/35.md` for full audit. Key findings:
  - `getShellCommand()` function is exported but never used in production (dead code)
  - `ShellInfo` interface duplicated 4 times (shellDetector.ts, preload.ts, types/index.ts, global.d.ts)
  - `which`/`where` platform detection pattern duplicated 5 times across codebase
  - Sequential shell detection could be parallelized for performance
  - Excellent type safety - no `any` types or issues found
  - Recommended 4 low-medium priority refactoring actions

- [x] **Task 36:** `src/main/utils/networkUtils.ts`
  Network utilities. Examine for:
  - Dead: Unused network functions
  - Deprecated: Old network patterns
  - Duplication: Network logic elsewhere
  - Smells: Timeout handling, error recovery
  - Types: Network result typing

  **Completed:** See `Auto Run Docs/Refactor/36.md` for full audit. Key findings:
  - Exemplary 170-line file with excellent 700+ line test coverage
  - `getLocalIpAddress()` async function exported but only used in tests (sync version preferred)
  - Magic numbers (UDP timeout, DNS port, interface priorities) could be named constants
  - No deprecated patterns, duplication, or type safety issues
  - Recommended 3 low-priority polish items

- [x] **Task 37:** `src/main/utils/terminalFilter.ts`
  Terminal output filtering. Examine for:
  - Dead: Unused filter patterns
  - Deprecated: Old terminal escape handling
  - Duplication: Filter logic elsewhere
  - Smells: Regex complexity, performance
  - Types: Filter result typing

  **Completed:** See `Auto Run Docs/Refactor/37.md` for full audit. Key findings:
  - Well-structured 176-line file with excellent 459-line test coverage
  - `isCommandEcho()` and `extractCommand()` exported but never used in production (dead code)
  - `stripAllAnsiCodes()` used in production but has no test coverage
  - ANSI stripping logic duplicated with simpler `src/shared/stringUtils.ts:stripAnsiCodes()`
  - Complex but well-documented regex patterns - could extract to named constants
  - Excellent type safety - no `any` types or issues found
  - Recommended 5 low-medium priority refactoring actions

- [x] **Task 38:** `src/main/utils/statsCache.ts`
  Stats caching. Examine for:
  - Dead: Unused cache methods
  - Deprecated: Old caching patterns
  - Duplication: Caching logic elsewhere
  - Smells: Cache invalidation, memory leaks
  - Types: Cache entry typing

  **Completed:** See `Auto Run Docs/Refactor/38.md` for full audit. Key findings:
  - Well-structured 186-line utility module with no dead code
  - Major duplication: `claude.ts` (lines 38-91) reimplements entire cache pattern with `LegacyGlobalStatsCache`
  - Two parallel cache files exist: `legacy-global-stats.json` and `global-stats.json`
  - Session stats interface fragmentation between `SessionStatsCache.sessions[id]` and `CachedSessionStats`
  - Unsafe `as` casts on JSON.parse results could cause runtime errors on corrupted cache
  - No time-based cache invalidation - only version-based
  - No unit tests exist for this module
  - Recommended 7 low-medium priority refactoring actions

- [x] **Task 39:** `src/main/utils/ipcHandler.ts`
  IPC handler utilities. Examine for:
  - Dead: Unused IPC utilities
  - Deprecated: Old IPC patterns
  - Duplication: IPC utils in handlers
  - Smells: Error handling, type safety
  - Types: IPC utility typing

  **Completed:** See `Auto Run Docs/Refactor/39.md` for full audit. Key findings:
  - 4 exported functions only used in tests, never in production: `createHandler`, `createDataHandler`, `withErrorLogging`, `createIpcDataHandler`
  - `handlerOpts` helper pattern duplicated 7 times across IPC handler files - could be centralized
  - Non-IPC variants serve no production purpose (all handlers need event-stripping variants)
  - Event parameter typed as `unknown` instead of `Electron.IpcMainInvokeEvent`
  - Error serialization loses structured info, converts objects to `[object Object]`
  - Excellent 939-line test coverage
  - Recommended 7 low-priority refactoring actions

- [x] **Task 40:** `src/main/utils/cliDetection.ts`
  CLI detection utilities. Examine for:
  - Dead: Unused detection methods
  - Deprecated: Old CLI detection patterns
  - Duplication: Detection logic elsewhere
  - Smells: Detection reliability
  - Types: CLI info typing

  **Completed:** See `Auto Run Docs/Refactor/40.md` for full audit. Key findings:
  - `clearCloudflaredCache()` is exported but only used in tests (dead code in production)
  - Major duplication: `getExpandedEnv()` PATH expansion logic duplicated in 4 locations (~120 lines total)
  - `which`/`where` platform detection pattern duplicated in 5 locations across codebase
  - `clearCloudflaredCache()` only clears one of two caches (confusing API)
  - Inconsistent path lists: cliDetection missing 2 paths present in agent-detector/agent-spawner
  - Excellent type safety - no `any` types or issues found
  - Recommended 6 refactoring actions prioritized by impact

---

## Main Process - Web Server (`src/main/web-server/`)

- [x] **Task 41:** `src/main/web-server/handlers/messageHandlers.ts`
  WebSocket message handlers. Examine for:
  - Dead: Message types never sent
  - Deprecated: Old WebSocket patterns
  - Duplication: Handler logic repeated
  - Smells: Message validation, error handling
  - Types: Message type safety

  **Completed:** See `Auto Run Docs/Refactor/41.md` for full audit. Key findings:
  - Well-structured 597-line file with excellent 600+ line test coverage
  - `LiveSessionInfo` interface duplicated in 4 files (messageHandlers, web-server, wsRoute, apiRoutes)
  - 34 repetitive `client.socket.send(JSON.stringify(...))` calls need helper extraction
  - `WebClientMessage` uses `[key: string]: unknown` index signature - should use discriminated union
  - 7 catch blocks have implicit `any` error type, access `.message` unsafely
  - `type: string` should be union of 11 valid message types
  - Recommended 7 low-to-high priority refactoring actions

- [x] **Task 42:** `src/main/web-server/routes/apiRoutes.ts`
  API route definitions. Examine for:
  - Dead: Routes never called
  - Deprecated: Old route patterns
  - Duplication: Route logic that could share
  - Smells: Route handler complexity
  - Types: Request/response typing

  **Completed:** See `Auto Run Docs/Refactor/42.md` for full audit. Key findings:
  - Well-structured 416-line file with no dead code or deprecated patterns
  - 7 type definitions (SessionUsageStats, AITabData, SessionData, etc.) duplicated across 4-5 files
  - Rate limit configuration pattern repeated 6 times - should extract to helper method
  - Session enrichment pattern duplicated in 3+ locations
  - 2 `error: any` in catch blocks that should use `unknown` with type guards
  - 4 unsafe `as` type assertions on request params that could use Fastify schema validation
  - No unit tests exist for this API module
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 43:** `src/main/web-server/routes/staticRoutes.ts`
  Static file serving. Examine for:
  - Dead: Static paths never requested
  - Deprecated: Old static serving patterns
  - Duplication: Static config repeated
  - Smells: Path traversal risks
  - Types: Static config typing

  **Completed:** See `Auto Run Docs/Refactor/43.md` for full audit. Key findings:
  - Well-structured 173-line file with no dead code or deprecated patterns
  - 6 synchronous file operations (`existsSync`, `readFileSync`) that could block event loop
  - Asset path replacement pattern repeated 4 times - could consolidate
  - File existence + read pattern repeated 3 times - could extract helper
  - 2 unsafe `as` type assertions on request params - should use Fastify type generics
  - Implicit `any` in catch block should be `unknown`
  - No unit tests exist for this security-sensitive component
  - Recommended 7 low-to-medium priority refactoring actions

- [x] **Task 44:** `src/main/web-server/routes/wsRoute.ts`
  WebSocket route. Examine for:
  - Dead: Unused connection handling
  - Deprecated: Old WebSocket setup
  - Duplication: WS logic with handlers
  - Smells: Connection lifecycle issues
  - Types: WebSocket typing

  **Completed:** See `Auto Run Docs/Refactor/44.md` for full audit. Key findings:
  - Well-structured 217-line file with no dead code or deprecated patterns
  - `LiveSessionInfo` interface duplicated in 4 files (wsRoute, messageHandlers, apiRoutes, web-server)
  - `CustomAICommand` interface duplicated in 4+ files across web-server and renderer
  - Session enrichment pattern (~10 lines) duplicated in 3-4 locations
  - 6 repetitive `socket.send(JSON.stringify(...))` calls could use helper extraction
  - No unit tests exist for this WebSocket route module
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 45:** `src/main/web-server/services/broadcastService.ts`
  Broadcast service. Examine for:
  - Dead: Unused broadcast types
  - Deprecated: Old broadcast patterns
  - Duplication: Broadcast logic elsewhere
  - Smells: Broadcast reliability, ordering
  - Types: Broadcast message typing

  **Completed:** See `Auto Run Docs/Refactor/45.md` for full audit. Key findings:
  - Well-structured 316-line module with excellent 497-line test coverage
  - No dead code or deprecated patterns found
  - `AITabData` interface duplicated in 4 files (broadcastService, web-server, apiRoutes, useWebSocket)
  - `CustomAICommand` interface duplicated in 5 files with inconsistent fields (missing `isBuiltIn`)
  - `CliActivity` local type is subset of `CliActivityStatus` from shared - could cause data loss
  - 12 repetitive `timestamp: Date.now()` patterns could be extracted to helper
  - `broadcastToAll(message: object)` is too loosely typed - should use discriminated union
  - Recommended 7 refactoring actions prioritized by impact

---

## Main Process - Group Chat (`src/main/group-chat/`)

- [x] **Task 46:** `src/main/group-chat/group-chat-agent.ts`
  Group chat agent logic. Examine for:
  - Dead: Unused agent handling code
  - Deprecated: Old agent integration patterns
  - Duplication: Agent logic with main agent code
  - Smells: Agent coordination complexity
  - Types: Agent state typing

  **Completed:** See `Auto Run Docs/Refactor/46.md` for full audit. Key findings:
  - Well-structured 311-line file with excellent 487-line test coverage
  - 4 functions only used in tests (`clearAllParticipantSessionsGlobal`, `getParticipantSessionId`, `isParticipantActive`, `getActiveParticipants`) - intentional test helpers
  - `GroupChatParticipant` interface duplicated in storage.ts and shared/group-chat-types.ts
  - `IProcessManager` interface missing `customEnvVars` field in groupChat.ts's `GenericProcessManager` copy
  - Fallback CWD pattern `process.env.HOME || '/tmp'` repeated 7 times across group-chat files
  - `images` parameter accepted by IPC handlers but never used in implementation
  - Recommended 7 low-to-medium priority refactoring actions

- [x] **Task 47:** `src/main/group-chat/group-chat-log.ts`
  Group chat logging. Examine for:
  - Dead: Unused log types/methods
  - Deprecated: Old logging patterns
  - Duplication: Logging with main logger
  - Smells: Log growth, retention
  - Types: Log entry typing

  **Completed:** See `Auto Run Docs/Refactor/47.md` for full audit. Key findings:
  - Well-structured 207-line utility module with excellent 339-line test coverage
  - `GroupChatMessage` interface duplicated in both group-chat-log.ts and shared/group-chat-types.ts
  - Image extension array `ALLOWED_IMAGE_EXTENSIONS` duplicated in 6+ locations with inconsistent values
  - Path traversal validation duplicated with autorun.ts - could reuse `validatePathWithinFolder()`
  - No dead code, deprecated patterns, or type safety issues found
  - Recommended 5 refactoring actions prioritized by impact

- [x] **Task 48:** `src/main/group-chat/group-chat-moderator.ts`
  Moderator logic. Examine for:
  - Dead: Unused moderation features
  - Deprecated: Old moderation patterns
  - Duplication: Logic with router
  - Smells: Moderation decision complexity
  - Types: Moderation result typing

  **Completed:** See `Auto Run Docs/Refactor/48.md` for full audit. Key findings:
  - 2 exported functions (`startSessionCleanup`, `stopSessionCleanup`) never called in production - dead code
  - `getModeratorChatLog()` function exported but never called anywhere - dead code
  - `IProcessManager` interface near-identical to `GenericProcessManager` in groupChat.ts, with `customEnvVars` mismatch
  - Fallback CWD pattern `process.env.HOME || '/tmp'` duplicated 7 times across group-chat files
  - Magic number for cleanup interval (10 minutes) should use named constant
  - `spawnModerator` has unused `_processManager` and `_cwd` parameters kept for API compatibility
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 49:** `src/main/group-chat/group-chat-router.ts`
  Message routing. Examine for:
  - Dead: Unused routing paths
  - Deprecated: Old routing patterns
  - Duplication: Routing with moderator
  - Smells: Routing logic complexity
  - Types: Route decision typing

  **Completed:** See `Auto Run Docs/Refactor/49.md` for full audit. Key findings:
  - Well-structured 723-line file with excellent 300+ line test coverage
  - Major duplication: Auto-add participant logic repeated twice (~45 lines each)
  - History context building repeated 3 times with different slice limits (-20, -15, -30)
  - Custom args parsing regex duplicated with process.ts
  - `process.env.HOME || '/tmp'` fallback CWD pattern repeated 7 times across group-chat files
  - `routeUserMessage` (170 lines) and `routeModeratorResponse` (171 lines) are large functions
  - `_processManager` parameter in `routeAgentResponse` is intentionally unused (API consistency)
  - Local `SessionInfo` interface should use `ToolType` instead of `string`
  - Recommended 7 refactoring actions prioritized by impact

- [x] **Task 50:** `src/main/group-chat/group-chat-storage.ts`
  Group chat persistence. Examine for:
  - Dead: Unused storage methods
  - Deprecated: Old persistence patterns
  - Duplication: Storage with main storage
  - Smells: Data integrity, concurrency
  - Types: Chat data typing

  **Completed:** See `Auto Run Docs/Refactor/50.md` for full audit. Key findings:
  - File is well-structured (594 lines) with excellent test coverage (366-line test file)
  - No dead code or deprecated patterns found
  - Major duplication: `GroupChatParticipant` and `GroupChat` interfaces duplicated with `shared/group-chat-types.ts`
  - `BootstrapSettings` interface duplicated in 3 locations
  - `getConfigDir()` pattern duplicated with CLI services (different implementations)
  - Type inconsistency: storage `updatedAt: number` (required) vs shared `updatedAt?: number` (optional)
  - 4 instances of ENOENT error handling pattern could use shared helper
  - Unsafe `as` casts on JSON.parse results lack runtime validation
  - Recommended 7 refactoring actions prioritized by impact

---

## Renderer - Core (`src/renderer/`)

- [x] **Task 51:** `src/renderer/App.tsx`
  Main React application. Examine for:
  - Dead: Unused state, dead effects, unreachable JSX
  - Deprecated: Class components, legacy lifecycle, old hooks patterns
  - Duplication: Logic that should be in hooks/components
  - Smells: Component size (should be <300 lines), prop drilling, re-render issues
  - Types: Props typing, state typing, event handler types

  **Completed:** See `Auto Run Docs/Refactor/51.md` for full audit. Key findings:
  - **CRITICAL God Component**: 6,833 lines (22x larger than 300-line guideline)
  - 109 `useState` calls, 32 `useEffect` hooks, 44 `useCallback` hooks
  - Deprecated `aiLogs` property still initialized on sessions (logs now in aiTabs)
  - 6 explicit `any` types, 3 `as any` casts, implicit any in catch blocks
  - Session update pattern duplicated 50+ times (`setSessions(prev => prev.map(...))`)
  - Tab update pattern duplicated 20+ times
  - System prompt substitution duplicated in processQueuedItem
  - Git branch fetching duplicated in message/command processing
  - Queue processing logic duplicated between interrupt and kill handlers (~90 lines)
  - `processQueuedItem` (230 lines), `handleInterrupt` (127 lines) exceed function size limits
  - Recommended incremental extraction to additional hooks:
    - `useGroupChatState`, `useAutoRunState`, `useModalState`, `useUIState`
    - `useQueueProcessor`, `useInterruptHandler`, `useCycleSession`
    - Consolidate `createNewSession` with `handleWizardLaunchSession`
    - Create `useSessionUpdater` for common update patterns

- [x] **Task 52:** `src/renderer/main.tsx`
  React entry point. Examine for:
  - Dead: Unused initialization code
  - Deprecated: Old React 18 patterns
  - Duplication: Init logic elsewhere
  - Smells: Root setup complexity
  - Types: Root typing

  **Completed:** See `Auto Run Docs/Refactor/52.md` for full audit. Key findings:
  - Exemplary 59-line file following modern React 18 best practices
  - No dead code, deprecated patterns, or type safety issues found
  - Uses ReactDOM.createRoot(), StrictMode, proper TypeScript event types
  - Minor: Non-null assertion on root element could use defensive check like web/main.tsx
  - Minor: Global error handlers (error/unhandledrejection) not shared with web
  - Minor: No unit tests exist (low priority for entry point)
  - File exemplifies clean code - stark contrast to App.tsx (6,833 lines)

- [x] **Task 53:** `src/renderer/slashCommands.ts`
  Slash command definitions. Examine for:
  - Dead: Commands never invoked
  - Deprecated: Old command patterns
  - Duplication: Command logic repeated
  - Smells: Command validation, parsing
  - Types: Command type safety

  **Completed:** See `Auto Run Docs/Refactor/53.md` for full audit. Key findings:
  - Minimal 20-line file with no dead code - only exports `/history` command
  - `SlashCommand` interface duplicated 4 times (slashCommands.ts, MainPanel.tsx, InputArea.tsx, SlashCommandAutocomplete.tsx)
  - MainPanel.tsx local interface missing `terminalOnly` and `aiOnly` fields
  - Mobile `DEFAULT_SLASH_COMMANDS` still has deprecated `/clear` and `/jump` (per ARCHITECTURE.md these are deprecated)
  - Description text for `/history` differs between desktop and mobile
  - No unit tests exist for this file
  - Recommended 4 refactoring actions: consolidate interface to shared/types.ts, remove deprecated mobile commands

- [x] **Task 54:** `src/renderer/types/index.ts`
  Type definitions. Examine for:
  - Dead: Types never used
  - Deprecated: Legacy type patterns
  - Duplication: Types that should be in shared/
  - Smells: Overly complex types, poor organization
  - Types: Type consistency, completeness

  **Completed:** See `Auto Run Docs/Refactor/54.md` for full audit. Key findings:
  - 7 dead/unused types: `LeaderboardRankingInfo`, `LeaderboardSubmitResponse`, `BadgeUnlockRecord`, `WorkLogItem`, `Shortcut`, `FileArtifact`, `QueuedItemType`
  - **Major duplication**: 11 interfaces duplicated across 2-7 locations each
  - `UsageStats` duplicated in 5 locations with variations
  - `AgentConfig` duplicated in 7 locations with different required/optional fields
  - `ProcessConfig` missing 9 fields that exist in global.d.ts version
  - 2 `any` types in `AgentConfigOption` that weaken type safety
  - `Session.fileTree: any[]` should use proper `FileTreeNode` type
  - Legacy `BatchRunState` fields marked for migration but still present
  - Recommended consolidating canonical definitions to shared/types.ts

- [ ] **Task 55:** `src/renderer/types/layer.ts`
  Layer stack types. Examine for:
  - Dead: Unused layer types
  - Deprecated: Old layer patterns
  - Duplication: Types in context
  - Smells: Layer type complexity
  - Types: Layer discriminated unions

---

## Renderer - Contexts (`src/renderer/contexts/`)

- [ ] **Task 56:** `src/renderer/contexts/GitStatusContext.tsx`
  Git status context. Examine for:
  - Dead: Unused context values, dead effects
  - Deprecated: Old context patterns
  - Duplication: Git logic with services
  - Smells: Polling performance, update frequency
  - Types: Context value typing

- [ ] **Task 57:** `src/renderer/contexts/ToastContext.tsx`
  Toast notification context. Examine for:
  - Dead: Unused toast types/methods
  - Deprecated: Old toast patterns
  - Duplication: Notification logic elsewhere
  - Smells: Toast queue management
  - Types: Toast type safety

- [ ] **Task 58:** `src/renderer/contexts/LayerStackContext.tsx`
  Modal layer stack. Examine for:
  - Dead: Unused layer operations
  - Deprecated: Old modal patterns
  - Duplication: Layer logic in components
  - Smells: Layer state management
  - Types: Layer registration typing

---

## Renderer - Constants (`src/renderer/constants/`)

- [ ] **Task 59:** `src/renderer/constants/shortcuts.ts`
  Keyboard shortcuts. Examine for:
  - Dead: Shortcuts never bound
  - Deprecated: Old shortcut definitions
  - Duplication: Shortcut handling spread out
  - Smells: Shortcut conflicts, discoverability
  - Types: Shortcut typing

- [ ] **Task 60:** `src/renderer/constants/themes.ts`
  Theme definitions. Examine for:
  - Dead: Unused theme properties
  - Deprecated: Old theme structure
  - Duplication: Themes in main/ and shared/
  - Smells: Theme validation, completeness
  - Types: Theme typing consistency

- [ ] **Task 61:** `src/renderer/constants/modalPriorities.ts`
  Modal priority definitions. Examine for:
  - Dead: Priorities for removed modals
  - Deprecated: Old priority system
  - Duplication: Priority logic elsewhere
  - Smells: Priority conflicts
  - Types: Priority typing

- [ ] **Task 62:** `src/renderer/constants/conductorBadges.ts`
  Badge definitions. Examine for:
  - Dead: Badges never displayed
  - Deprecated: Old badge system
  - Duplication: Badge logic elsewhere
  - Smells: Badge criteria clarity
  - Types: Badge typing

---

## Renderer - Utilities (`src/renderer/utils/`)

- [ ] **Task 63:** `src/renderer/utils/templateVariables.ts`
  Template variable processing. Examine for:
  - Dead: Unused template functions
  - Deprecated: Old template patterns
  - Duplication: Same logic in shared/templateVariables.ts
  - Smells: Template parsing robustness
  - Types: Template typing

- [ ] **Task 64:** `src/renderer/utils/gitDiffParser.ts`
  Git diff parsing. Examine for:
  - Dead: Unused parsing functions
  - Deprecated: Old diff format handling
  - Duplication: Diff logic elsewhere
  - Smells: Parser robustness, edge cases
  - Types: Diff result typing

- [ ] **Task 65:** `src/renderer/utils/remarkFileLinks.ts`
  Markdown file link plugin. Examine for:
  - Dead: Unused link handling
  - Deprecated: Old remark plugin patterns
  - Duplication: Link handling elsewhere
  - Smells: Link resolution reliability
  - Types: Plugin typing

- [ ] **Task 66:** `src/renderer/utils/remarkFrontmatterTable.ts`
  Frontmatter parsing. Examine for:
  - Dead: Unused frontmatter handling
  - Deprecated: Old frontmatter patterns
  - Duplication: Frontmatter logic elsewhere
  - Smells: Parse error handling
  - Types: Frontmatter typing

- [ ] **Task 67:** `src/renderer/utils/markdownConfig.ts`
  Markdown configuration. Examine for:
  - Dead: Unused markdown options
  - Deprecated: Old markdown-it/remark patterns
  - Duplication: Config spread across files
  - Smells: Config complexity
  - Types: Config typing

- [ ] **Task 68:** `src/renderer/utils/textProcessing.ts`
  Text processing utilities. Examine for:
  - Dead: Unused text functions
  - Deprecated: Old string handling
  - Duplication: Text utils elsewhere
  - Smells: Unicode handling, performance
  - Types: Text function typing

- [ ] **Task 69:** `src/renderer/utils/formatters.ts`
  Formatting utilities. Examine for:
  - Dead: Unused formatters
  - Deprecated: Old formatting patterns
  - Duplication: Formatters in shared/formatters.ts
  - Smells: Locale handling, edge cases
  - Types: Formatter typing

- [ ] **Task 70:** `src/renderer/utils/logger.ts`
  Renderer logger. Examine for:
  - Dead: Unused log methods
  - Deprecated: Old console patterns
  - Duplication: Logger in main/ and web/
  - Smells: Log performance, filtering
  - Types: Log entry typing

- [ ] **Task 71:** `src/renderer/utils/shortcutMatcher.ts`
  Shortcut matching. Examine for:
  - Dead: Unused matching functions
  - Deprecated: Old key event handling
  - Duplication: Matching in handlers
  - Smells: Cross-platform key handling
  - Types: Key event typing

- [ ] **Task 72:** `src/renderer/utils/shortcutFormatter.ts`
  Shortcut formatting. Examine for:
  - Dead: Unused format functions
  - Deprecated: Old display patterns
  - Duplication: Formatting elsewhere
  - Smells: Platform-specific display
  - Types: Format result typing

- [ ] **Task 73:** `src/renderer/utils/tabHelpers.ts`
  Tab management utilities. Examine for:
  - Dead: Unused tab functions
  - Deprecated: Old tab patterns
  - Duplication: Tab logic in components
  - Smells: Tab state management
  - Types: Tab typing

- [ ] **Task 74:** `src/renderer/utils/fileExplorer.ts`
  File explorer utilities. Examine for:
  - Dead: Unused file functions
  - Deprecated: Old file handling
  - Duplication: File logic in hooks
  - Smells: Path handling, permissions
  - Types: File tree typing

- [ ] **Task 75:** `src/renderer/utils/sessionValidation.ts`
  Session validation. Examine for:
  - Dead: Unused validation functions
  - Deprecated: Old validation patterns
  - Duplication: Validation elsewhere
  - Smells: Validation completeness
  - Types: Validation result typing

- [ ] **Task 76:** `src/renderer/utils/theme.tsx`
  Theme utilities. Examine for:
  - Dead: Unused theme functions
  - Deprecated: Old theme handling
  - Duplication: Theme logic scattered
  - Smells: Theme application consistency
  - Types: Theme utility typing

- [ ] **Task 77:** `src/renderer/utils/search.ts`
  Search utilities. Examine for:
  - Dead: Unused search functions
  - Deprecated: Old search patterns
  - Duplication: Search in components
  - Smells: Search performance, fuzzy matching
  - Types: Search result typing

- [ ] **Task 78:** `src/renderer/utils/ids.ts`
  ID generation. Examine for:
  - Dead: Unused ID functions
  - Deprecated: Old ID patterns
  - Duplication: ID generation elsewhere
  - Smells: ID uniqueness guarantees
  - Types: ID typing

- [ ] **Task 79:** `src/renderer/utils/participantColors.ts`
  Participant color assignment. Examine for:
  - Dead: Unused color functions
  - Deprecated: Old color assignment
  - Duplication: Color logic elsewhere
  - Smells: Color accessibility, collisions
  - Types: Color typing

---

## Renderer - Services (`src/renderer/services/`)

- [ ] **Task 80:** `src/renderer/services/git.ts`
  Git service wrapper. Examine for:
  - Dead: Unused git methods
  - Deprecated: Old git service patterns
  - Duplication: Logic with IPC handlers
  - Smells: Error handling, caching
  - Types: Git result typing

- [ ] **Task 81:** `src/renderer/services/process.ts`
  Process service wrapper. Examine for:
  - Dead: Unused process methods
  - Deprecated: Old service patterns
  - Duplication: Logic with IPC handlers
  - Smells: Process state tracking
  - Types: Process typing

- [ ] **Task 82:** `src/renderer/services/ipcWrapper.ts`
  IPC wrapper utilities. Examine for:
  - Dead: Unused wrappers
  - Deprecated: Old IPC wrapper patterns
  - Duplication: Wrappers for same endpoints
  - Smells: Error handling consistency
  - Types: IPC typing

---

## Renderer - Hooks (`src/renderer/hooks/`)

- [ ] **Task 83:** `src/renderer/hooks/useSettings.ts`
  Settings management. Examine for:
  - Dead: Unused settings, dead setters
  - Deprecated: Old settings patterns
  - Duplication: Settings logic spread out
  - Smells: Settings persistence timing, validation
  - Types: Settings type completeness

- [ ] **Task 84:** `src/renderer/hooks/useSessionManager.ts`
  Session management. Examine for:
  - Dead: Unused session operations
  - Deprecated: Old session patterns
  - Duplication: Session logic in components
  - Smells: Session state complexity, race conditions
  - Types: Session typing

- [ ] **Task 85:** `src/renderer/hooks/useBatchProcessor.ts`
  Batch processing. Examine for:
  - Dead: Unused batch operations
  - Deprecated: Old batch patterns
  - Duplication: Batch logic elsewhere
  - Smells: Batch state management, cancellation
  - Types: Batch state typing

- [ ] **Task 86:** `src/renderer/hooks/useAgentCapabilities.ts`
  Agent capabilities hook. Examine for:
  - Dead: Unused capability checks
  - Deprecated: Old capability patterns
  - Duplication: Capability checks scattered
  - Smells: Capability caching, updates
  - Types: Capability typing

- [ ] **Task 87:** `src/renderer/hooks/useAgentErrorRecovery.tsx`
  Error recovery hook. Examine for:
  - Dead: Unused recovery paths
  - Deprecated: Old error handling patterns
  - Duplication: Error handling elsewhere
  - Smells: Recovery state machine complexity
  - Types: Error typing

- [ ] **Task 88:** `src/renderer/hooks/useAgentExecution.ts`
  Agent execution hook. Examine for:
  - Dead: Unused execution paths
  - Deprecated: Old execution patterns
  - Duplication: Execution logic scattered
  - Smells: Execution state management
  - Types: Execution typing

- [ ] **Task 89:** `src/renderer/hooks/useAgentSessionManagement.ts`
  Session management hook. Examine for:
  - Dead: Unused session methods
  - Deprecated: Old session patterns
  - Duplication: Overlap with useSessionManager.ts
  - Smells: Session lifecycle complexity
  - Types: Session typing

- [ ] **Task 90:** `src/renderer/hooks/useAutoRunHandlers.ts`
  Auto Run handlers. Examine for:
  - Dead: Unused handlers
  - Deprecated: Old Auto Run patterns
  - Duplication: Handler logic repeated
  - Smells: Handler complexity, side effects
  - Types: Handler typing

- [ ] **Task 91:** `src/renderer/hooks/useAutoRunImageHandling.ts`
  Image handling for Auto Run. Examine for:
  - Dead: Unused image operations
  - Deprecated: Old image patterns
  - Duplication: Image logic elsewhere
  - Smells: Image loading, memory management
  - Types: Image typing

- [ ] **Task 92:** `src/renderer/hooks/useAutoRunUndo.ts`
  Auto Run undo functionality. Examine for:
  - Dead: Unused undo operations
  - Deprecated: Old undo patterns
  - Duplication: Undo logic elsewhere
  - Smells: Undo stack management
  - Types: Undo state typing

- [ ] **Task 93:** `src/renderer/hooks/useFileExplorer.ts`
  File explorer hook. Examine for:
  - Dead: Unused explorer operations
  - Deprecated: Old file tree patterns
  - Duplication: Explorer logic in utils
  - Smells: Tree performance, lazy loading
  - Types: File tree typing

- [ ] **Task 94:** `src/renderer/hooks/useFileTreeManagement.ts`
  File tree management. Examine for:
  - Dead: Unused tree operations
  - Deprecated: Old tree patterns
  - Duplication: Overlap with useFileExplorer.ts
  - Smells: Tree state synchronization
  - Types: Tree typing

- [ ] **Task 95:** `src/renderer/hooks/useGitStatusPolling.ts`
  Git polling hook. Examine for:
  - Dead: Unused polling features
  - Deprecated: Old polling patterns
  - Duplication: Polling in context
  - Smells: Polling frequency, performance
  - Types: Poll result typing

- [ ] **Task 96:** `src/renderer/hooks/useGroupManagement.ts`
  Group management hook. Examine for:
  - Dead: Unused group operations
  - Deprecated: Old group patterns
  - Duplication: Group logic scattered
  - Smells: Group state consistency
  - Types: Group typing

- [ ] **Task 97:** `src/renderer/hooks/useInputProcessing.ts`
  Input processing hook. Examine for:
  - Dead: Unused processing paths
  - Deprecated: Old input patterns
  - Duplication: Processing elsewhere
  - Smells: Input validation, sanitization
  - Types: Input typing

- [ ] **Task 98:** `src/renderer/hooks/useKeyboardNavigation.ts`
  Keyboard navigation. Examine for:
  - Dead: Unused navigation handlers
  - Deprecated: Old keyboard patterns
  - Duplication: Navigation in components
  - Smells: Focus management complexity
  - Types: Navigation typing

- [ ] **Task 99:** `src/renderer/hooks/useMainKeyboardHandler.ts`
  Main keyboard handler. Examine for:
  - Dead: Unused key handlers
  - Deprecated: Old keyboard event patterns
  - Duplication: Key handling scattered
  - Smells: Handler priority, conflicts
  - Types: Keyboard event typing

- [ ] **Task 100:** `src/renderer/hooks/useModalManager.ts`
  Modal management. Examine for:
  - Dead: Unused modal operations
  - Deprecated: Old modal patterns
  - Duplication: Modal logic in context
  - Smells: Modal stack management
  - Types: Modal typing

- [ ] **Task 101:** `src/renderer/hooks/usePlaybookManagement.ts`
  Playbook management. Examine for:
  - Dead: Unused playbook operations
  - Deprecated: Old playbook patterns
  - Duplication: Playbook logic elsewhere
  - Smells: Playbook state management
  - Types: Playbook typing

- [ ] **Task 102:** `src/renderer/hooks/useRemoteIntegration.ts`
  Remote integration. Examine for:
  - Dead: Unused remote operations
  - Deprecated: Old remote patterns
  - Duplication: Remote logic scattered
  - Smells: Connection management
  - Types: Remote typing

- [ ] **Task 103:** `src/renderer/hooks/useWebBroadcasting.ts`
  Web broadcasting hook. Examine for:
  - Dead: Unused broadcast operations
  - Deprecated: Old broadcast patterns
  - Duplication: Broadcast logic in services
  - Smells: Broadcast reliability
  - Types: Broadcast typing

- [ ] **Task 104:** `src/renderer/hooks/useWorktreeValidation.ts`
  Worktree validation. Examine for:
  - Dead: Unused validation checks
  - Deprecated: Old worktree patterns
  - Duplication: Validation elsewhere
  - Smells: Validation timing, errors
  - Types: Validation typing

- [ ] **Task 105:** Remaining hooks in `src/renderer/hooks/`
  Examine ALL five categories for each:
  - useAchievements.ts
  - useActivityTracker.ts
  - useAtMentionCompletion.ts
  - useBatchedSessionUpdates.ts
  - useCliActivityMonitoring.ts
  - useClickOutside.ts
  - useDebouncedPersistence.ts
  - useExpandedSet.ts
  - useFilteredAndSortedSessions.ts
  - useFocusManager.ts
  - useInputSync.ts
  - useKeyboardShortcutHelpers.ts
  - useLayerStack.ts
  - useListNavigation.ts
  - useLiveOverlay.ts
  - useMobileLandscape.ts
  - useModalLayer.ts
  - useNavigationHistory.ts
  - useScrollPosition.ts
  - useSessionNavigation.ts
  - useSessionPagination.ts
  - useSessionViewer.ts
  - useSortedSessions.ts
  - useTabCompletion.ts
  - useTemplateAutocomplete.ts
  - useThemeStyles.ts
  - useThrottle.ts

---

## Renderer - Components (Large Files)

- [ ] **Task 106:** `src/renderer/components/SessionList.tsx`
  Session list component. Examine for:
  - Dead: Unused rendering paths, dead props
  - Deprecated: Old React patterns, class components
  - Duplication: Rendering logic that repeats
  - Smells: Component size (>300 lines), deep nesting, re-render issues
  - Types: Props/state typing, event handlers

- [ ] **Task 107:** `src/renderer/components/MainPanel.tsx`
  Main panel component. Examine for:
  - Dead: Unused panel states, dead conditional rendering
  - Deprecated: Old layout patterns
  - Duplication: Panel logic repeated
  - Smells: Component complexity, mode switching
  - Types: Panel props typing

- [ ] **Task 108:** `src/renderer/components/RightPanel.tsx`
  Right panel component. Examine for:
  - Dead: Unused tabs, dead rendering paths
  - Deprecated: Old tab patterns
  - Duplication: Tab handling repeated
  - Smells: Tab state management
  - Types: Tab props typing

- [ ] **Task 109:** `src/renderer/components/LogViewer.tsx`
  Log viewer component. Examine for:
  - Dead: Unused log display modes
  - Deprecated: Old virtualization patterns
  - Duplication: Log rendering logic
  - Smells: Performance with large logs, memory
  - Types: Log entry typing

- [ ] **Task 110:** `src/renderer/components/InputArea.tsx`
  Input area component. Examine for:
  - Dead: Unused input modes, dead handlers
  - Deprecated: Old input patterns
  - Duplication: Input handling repeated
  - Smells: Input state complexity, autocomplete
  - Types: Input props typing

- [ ] **Task 111:** `src/renderer/components/SettingsModal.tsx`
  Settings modal. Examine for:
  - Dead: Unused settings UI, dead sections
  - Deprecated: Old form patterns
  - Duplication: Settings sections similar
  - Smells: Modal size, settings organization
  - Types: Settings props typing

- [ ] **Task 112:** `src/renderer/components/AutoRun.tsx`
  Auto Run component. Examine for:
  - Dead: Unused Auto Run UI states
  - Deprecated: Old document handling
  - Duplication: Document UI repeated
  - Smells: Component complexity, state management
  - Types: Auto Run props typing

- [ ] **Task 113:** `src/renderer/components/HistoryPanel.tsx`
  History panel. Examine for:
  - Dead: Unused history UI elements
  - Deprecated: Old list patterns
  - Duplication: History item rendering
  - Smells: Performance with large history
  - Types: History entry typing

- [ ] **Task 114:** `src/renderer/components/FileExplorerPanel.tsx`
  File explorer panel. Examine for:
  - Dead: Unused explorer features
  - Deprecated: Old tree patterns
  - Duplication: Tree rendering logic
  - Smells: Tree performance, lazy loading
  - Types: File node typing

- [ ] **Task 115:** `src/renderer/components/TerminalOutput.tsx`
  Terminal output component. Examine for:
  - Dead: Unused terminal display modes
  - Deprecated: Old terminal rendering
  - Duplication: Output handling repeated
  - Smells: Performance, ANSI handling
  - Types: Terminal output typing

- [ ] **Task 116:** `src/renderer/components/MarkdownRenderer.tsx`
  Markdown renderer. Examine for:
  - Dead: Unused markdown features
  - Deprecated: Old markdown-it/remark patterns
  - Duplication: Rendering plugins similar
  - Smells: Rendering performance, XSS risks
  - Types: Markdown props typing

---

## Renderer - Components (Modals)

- [ ] **Task 117:** Modal components batch 1
  Examine ALL five categories for each:
  - ConfirmModal.tsx
  - NewInstanceModal.tsx
  - RenameSessionModal.tsx
  - RenameTabModal.tsx
  - RenameGroupModal.tsx
  - CreateGroupModal.tsx

- [ ] **Task 118:** Modal components batch 2
  Examine ALL five categories for each:
  - AgentErrorModal.tsx
  - AgentSessionsModal.tsx
  - AgentPromptComposerModal.tsx
  - PromptComposerModal.tsx
  - QuickActionsModal.tsx

- [ ] **Task 119:** Modal components batch 3
  Examine ALL five categories for each:
  - BatchRunnerModal.tsx
  - PlaybookNameModal.tsx
  - PlaybookDeleteConfirmModal.tsx
  - AutoRunSetupModal.tsx
  - AutoRunExpandedModal.tsx
  - AutoRunnerHelpModal.tsx

- [ ] **Task 120:** Modal components batch 4
  Examine ALL five categories for each:
  - FileSearchModal.tsx
  - TabSwitcherModal.tsx
  - ShortcutsHelpModal.tsx
  - HistoryDetailModal.tsx
  - HistoryHelpModal.tsx
  - AboutModal.tsx
  - UpdateCheckModal.tsx

- [ ] **Task 121:** Modal components batch 5 (Group Chat)
  Examine ALL five categories for each:
  - NewGroupChatModal.tsx
  - DeleteGroupChatModal.tsx
  - RenameGroupChatModal.tsx

- [ ] **Task 122:** Other modal components
  Examine ALL five categories for each:
  - LightboxModal.tsx
  - CustomThemeBuilder.tsx
  - ShortcutEditor.tsx
  - LeaderboardRegistrationModal.tsx
  - FirstRunCelebration.tsx
  - DebugWizardModal.tsx

---

## Renderer - Components (Group Chat)

- [ ] **Task 123:** `src/renderer/components/GroupChatPanel.tsx`
  Group chat panel. Examine for:
  - Dead: Unused panel states
  - Deprecated: Old chat patterns
  - Duplication: Panel logic repeated
  - Smells: Panel complexity, state
  - Types: Panel props typing

- [ ] **Task 124:** `src/renderer/components/GroupChatMessages.tsx`
  Message display. Examine for:
  - Dead: Unused message types
  - Deprecated: Old message rendering
  - Duplication: Message rendering repeated
  - Smells: Virtualization, performance
  - Types: Message typing

- [ ] **Task 125:** `src/renderer/components/GroupChatInput.tsx`
  Input component. Examine for:
  - Dead: Unused input features
  - Deprecated: Old input patterns
  - Duplication: Input logic with main InputArea
  - Smells: Input state management
  - Types: Input props typing

- [ ] **Task 126:** `src/renderer/components/GroupChatHeader.tsx`
  Header component. Examine for:
  - Dead: Unused header elements
  - Deprecated: Old header patterns
  - Duplication: Header rendering
  - Smells: Header complexity
  - Types: Header props typing

- [ ] **Task 127:** `src/renderer/components/GroupChatRightPanel.tsx`
  Right panel. Examine for:
  - Dead: Unused panel tabs
  - Deprecated: Old panel patterns
  - Duplication: Panel with main RightPanel
  - Smells: Panel state management
  - Types: Panel props typing

- [ ] **Task 128:** `src/renderer/components/GroupChatParticipants.tsx`
  Participant list. Examine for:
  - Dead: Unused participant features
  - Deprecated: Old list patterns
  - Duplication: Participant rendering
  - Smells: List performance
  - Types: Participant typing

- [ ] **Task 129:** `src/renderer/components/GroupChatList.tsx`
  Group chat list. Examine for:
  - Dead: Unused list features
  - Deprecated: Old list patterns
  - Duplication: List rendering
  - Smells: List performance
  - Types: List item typing

- [ ] **Task 130:** Group chat supporting components
  Examine ALL five categories for each:
  - GroupChatHistoryPanel.tsx
  - GroupChatInfoOverlay.tsx
  - ParticipantCard.tsx

---

## Renderer - Components (Miscellaneous)

- [ ] **Task 131:** Git-related components
  Examine ALL five categories for each:
  - GitDiffViewer.tsx
  - GitLogViewer.tsx
  - GitStatusWidget.tsx
  - GitWorktreeSection.tsx

- [ ] **Task 132:** Session-related components
  Examine ALL five categories for each:
  - SessionItem.tsx
  - SessionListItem.tsx
  - SessionActivityGraph.tsx

- [ ] **Task 133:** Auto Run supporting components
  Examine ALL five categories for each:
  - AutoRunDocumentSelector.tsx
  - AutoRunLightbox.tsx
  - AutoRunSearchBar.tsx

- [ ] **Task 134:** Viewer and display components
  Examine ALL five categories for each:
  - CollapsibleJsonViewer.tsx
  - FilePreview.tsx
  - ImageDiffViewer.tsx
  - MermaidRenderer.tsx
  - ThinkingStatusPill.tsx

- [ ] **Task 135:** UI feedback components
  Examine ALL five categories for each:
  - Toast.tsx
  - ErrorBoundary.tsx
  - EmptyStateView.tsx
  - StandingOvationOverlay.tsx
  - QRCode.tsx
  - MaestroSilhouette.tsx

- [ ] **Task 136:** Tab and queue components
  Examine ALL five categories for each:
  - TabBar.tsx
  - ExecutionQueueIndicator.tsx
  - ExecutionQueueBrowser.tsx
  - QueuedItemsList.tsx

- [ ] **Task 137:** Miscellaneous components
  Examine ALL five categories for each:
  - AICommandsPanel.tsx
  - NotificationsPanel.tsx
  - DocumentsPanel.tsx
  - PlaygroundPanel.tsx
  - ProcessMonitor.tsx
  - ThemePicker.tsx
  - FontConfigurationPanel.tsx
  - ToggleButtonGroup.tsx
  - LogFilterControls.tsx
  - AchievementCard.tsx
  - SettingCheckbox.tsx

---

## Renderer - Wizard (`src/renderer/components/Wizard/`)

- [ ] **Task 138:** Wizard core components
  Examine ALL five categories for each:
  - MaestroWizard.tsx
  - WizardContext.tsx
  - WizardResumeModal.tsx
  - WizardExitConfirmModal.tsx
  - ExistingAutoRunDocsModal.tsx
  - ScreenReaderAnnouncement.tsx

- [ ] **Task 139:** Wizard screens
  Examine ALL five categories for each:
  - screens/AgentSelectionScreen.tsx
  - screens/DirectorySelectionScreen.tsx
  - screens/ConversationScreen.tsx
  - screens/PhaseReviewScreen.tsx
  - screens/PreparingPlanScreen.tsx

- [ ] **Task 140:** Wizard services
  Examine ALL five categories for each:
  - services/wizardPrompts.ts
  - services/conversationManager.ts
  - services/phaseGenerator.ts
  - services/fillerPhrases.ts
  - services/austinFacts.ts

- [ ] **Task 141:** Tour system
  Examine ALL five categories for each:
  - tour/TourOverlay.tsx
  - tour/TourStep.tsx
  - tour/tourSteps.ts
  - tour/useTour.tsx

---

## Renderer - UI Components (`src/renderer/components/ui/`)

- [ ] **Task 142:** UI components
  Examine ALL five categories for each:
  - Modal.tsx
  - FormInput.tsx
  - EmojiPickerField.tsx

- [ ] **Task 143:** Shared components (`src/renderer/components/shared/`)
  Examine ALL five categories for:
  - AgentConfigPanel.tsx

---

## Shared (`src/shared/`)

- [ ] **Task 144:** `src/shared/types.ts`
  Core type definitions. Examine for:
  - Dead: Types never imported
  - Deprecated: Legacy type patterns
  - Duplication: Types also in renderer/types
  - Smells: Type organization, complexity
  - Types: Type consistency, strictness

- [ ] **Task 145:** `src/shared/templateVariables.ts`
  Template variable processing. Examine for:
  - Dead: Unused template functions
  - Deprecated: Old template patterns
  - Duplication: Same in renderer/utils/templateVariables.ts
  - Smells: Template parsing robustness
  - Types: Template typing

- [ ] **Task 146:** `src/shared/themes.ts`
  Shared theme definitions. Examine for:
  - Dead: Unused theme properties
  - Deprecated: Old theme format
  - Duplication: Themes in main/ and renderer/
  - Smells: Theme validation
  - Types: Theme typing

- [ ] **Task 147:** `src/shared/formatters.ts`
  Shared formatters. Examine for:
  - Dead: Unused formatters
  - Deprecated: Old formatting patterns
  - Duplication: Formatters in renderer/utils
  - Smells: Locale handling
  - Types: Formatter typing

- [ ] **Task 148:** `src/shared/gitUtils.ts`
  Git utilities. Examine for:
  - Dead: Unused git utilities
  - Deprecated: Old git patterns
  - Duplication: Git utils elsewhere
  - Smells: Git parsing robustness
  - Types: Git result typing

- [ ] **Task 149:** `src/shared/history.ts`
  History types and utilities. Examine for:
  - Dead: Unused history types
  - Deprecated: Old history format
  - Duplication: History types elsewhere
  - Smells: History entry completeness
  - Types: History typing

- [ ] **Task 150:** `src/shared/group-chat-types.ts`
  Group chat types. Examine for:
  - Dead: Unused chat types
  - Deprecated: Old chat type patterns
  - Duplication: Types elsewhere
  - Smells: Type organization
  - Types: Chat typing completeness

- [ ] **Task 151:** `src/shared/synopsis.ts`
  Synopsis generation. Examine for:
  - Dead: Unused synopsis functions
  - Deprecated: Old synopsis patterns
  - Duplication: Synopsis logic elsewhere
  - Smells: Synopsis generation robustness
  - Types: Synopsis typing

- [ ] **Task 152:** `src/shared/treeUtils.ts`
  Tree utilities. Examine for:
  - Dead: Unused tree functions
  - Deprecated: Old tree patterns
  - Duplication: Tree utils elsewhere
  - Smells: Tree traversal performance
  - Types: Tree typing

- [ ] **Task 153:** Other shared utilities
  Examine ALL five categories for each:
  - emojiUtils.ts
  - stringUtils.ts
  - cli-activity.ts
  - theme-types.ts

---

## CLI (`src/cli/`)

- [ ] **Task 154:** `src/cli/index.ts`
  CLI entry point. Examine for:
  - Dead: Unused command registration
  - Deprecated: Old CLI patterns
  - Duplication: CLI logic elsewhere
  - Smells: Command parsing, help text
  - Types: Command typing

- [ ] **Task 155:** CLI commands
  Examine ALL five categories for each:
  - commands/list-agents.ts
  - commands/list-groups.ts
  - commands/list-playbooks.ts
  - commands/run-playbook.ts
  - commands/show-agent.ts
  - commands/show-playbook.ts

- [ ] **Task 156:** CLI services
  Examine ALL five categories for each:
  - services/agent-spawner.ts
  - services/batch-processor.ts
  - services/playbooks.ts
  - services/storage.ts

- [ ] **Task 157:** CLI output
  Examine ALL five categories for each:
  - output/formatter.ts
  - output/jsonl.ts

---

## Web (`src/web/`)

- [ ] **Task 158:** Web entry and core
  Examine ALL five categories for each:
  - index.ts
  - main.tsx

- [ ] **Task 159:** Web components
  Examine ALL five categories for each:
  - components/Badge.tsx
  - components/Button.tsx
  - components/Card.tsx
  - components/Input.tsx
  - components/PullToRefresh.tsx
  - components/ThemeProvider.tsx

- [ ] **Task 160:** Web hooks batch 1
  Examine ALL five categories for each:
  - hooks/useWebSocket.ts
  - hooks/useSessions.ts
  - hooks/useCommandHistory.ts
  - hooks/useNotifications.ts
  - hooks/useOfflineQueue.ts

- [ ] **Task 161:** Web hooks batch 2
  Examine ALL five categories for each:
  - hooks/useMobileAutoReconnect.ts
  - hooks/useMobileKeyboardHandler.ts
  - hooks/useMobileSessionManagement.ts
  - hooks/useMobileViewState.ts

- [ ] **Task 162:** Web hooks batch 3
  Examine ALL five categories for each:
  - hooks/useDeviceColorScheme.ts
  - hooks/useKeyboardVisibility.ts
  - hooks/useLongPressMenu.ts
  - hooks/usePullToRefresh.ts
  - hooks/useSlashCommandAutocomplete.ts
  - hooks/useSwipeGestures.ts
  - hooks/useSwipeUp.ts
  - hooks/useUnreadBadge.ts
  - hooks/useVoiceInput.ts

- [ ] **Task 163:** Web utilities
  Examine ALL five categories for each:
  - utils/config.ts
  - utils/cssCustomProperties.ts
  - utils/logger.ts
  - utils/serviceWorker.ts
  - utils/viewState.ts

---

## Mobile (`src/web/mobile/`)

- [ ] **Task 164:** Mobile core
  Examine ALL five categories for each:
  - App.tsx
  - index.tsx
  - constants.ts

- [ ] **Task 165:** Mobile components batch 1
  Examine ALL five categories for each:
  - AllSessionsView.tsx
  - MessageHistory.tsx
  - ResponseViewer.tsx
  - CommandInputBar.tsx
  - CommandInputButtons.tsx

- [ ] **Task 166:** Mobile components batch 2
  Examine ALL five categories for each:
  - SessionPillBar.tsx
  - SessionStatusBanner.tsx
  - TabBar.tsx
  - TabSearchModal.tsx

- [ ] **Task 167:** Mobile components batch 3
  Examine ALL five categories for each:
  - AutoRunIndicator.tsx
  - ConnectionStatusIndicator.tsx
  - OfflineQueueBanner.tsx
  - QuickActionsMenu.tsx

- [ ] **Task 168:** Mobile components batch 4
  Examine ALL five categories for each:
  - CommandHistoryDrawer.tsx
  - MobileHistoryPanel.tsx
  - RecentCommandChips.tsx
  - SlashCommandAutocomplete.tsx

---

## Prompts (`src/prompts/`)

- [ ] **Task 169:** `src/prompts/index.ts`
  Prompt exports. Examine for:
  - Dead: Unused prompt exports
  - Deprecated: Old prompt format
  - Duplication: Similar prompts
  - Smells: Prompt organization
  - Types: Prompt typing

---

## Cross-Cutting Concerns

- [ ] **Task 170:** Theme Duplication Analysis
  Compare and identify consolidation opportunities across:
  - src/main/themes.ts
  - src/renderer/constants/themes.ts
  - src/shared/themes.ts
  - src/shared/theme-types.ts

  Document: Which file should be canonical? What can be deleted?

- [ ] **Task 171:** Formatter Duplication Analysis
  Compare and identify consolidation opportunities:
  - src/renderer/utils/formatters.ts
  - src/shared/formatters.ts

  Document: Which formatters are duplicated? Which file should own them?

- [ ] **Task 172:** Logger Duplication Analysis
  Compare and identify consolidation opportunities:
  - src/main/utils/logger.ts
  - src/renderer/utils/logger.ts
  - src/web/utils/logger.ts

  Document: Can these share a common base? What's different?

- [ ] **Task 173:** Template Variable Duplication Analysis
  Compare and identify consolidation opportunities:
  - src/renderer/utils/templateVariables.ts
  - src/shared/templateVariables.ts

  Document: Why are there two? Which should be canonical?

- [ ] **Task 174:** Type Definition Consolidation
  Review all type definitions and recommend consolidation:
  - src/renderer/types/
  - src/shared/types.ts
  - src/shared/group-chat-types.ts

  Document: What types should move to shared? What's renderer-specific?

- [ ] **Task 175:** Hook Consolidation Analysis
  Identify hooks with overlapping functionality:
  - useSessionManager vs useAgentSessionManagement
  - useFileExplorer vs useFileTreeManagement
  - Similar patterns that could share code

  Document: Which hooks could be merged? What abstractions are missing?

---

## Final Summary

- [ ] **Task 176:** Final Summary and Priority Matrix
  After completing all individual analyses, create a comprehensive summary:

  **Quantitative Summary:**
  - Total dead code items found
  - Total deprecated patterns found
  - Total duplication instances found
  - Total code smells found
  - Total type safety issues found

  **Top 10 Highest-Impact Refactors:**
  Ranked by: effort vs benefit, risk level, dependency count

  **Recommended Refactoring Sequence:**
  Phase 1 (Low risk, high value): ...
  Phase 2 (Medium risk): ...
  Phase 3 (High risk, requires careful testing): ...

  **Testing Strategy:**
  - Which refactors need unit tests first?
  - Which need integration tests?
  - Which need manual QA?

  **Risk Assessment:**
  - Breaking change risks
  - Performance regression risks
  - Data migration needs
